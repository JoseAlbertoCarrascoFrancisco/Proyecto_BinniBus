import csv

def kml_to_latlon(coords_kml):
    """
    Convierte coordenadas en formato KML (lon,lat,alt) a lista [(lat, lon)].
    Ignora la altitud.
    """
    coords = []
    for line in coords_kml.strip().splitlines():
        parts = line.strip().split(",")
        if len(parts) >= 2:
            lon = float(parts[0])  # KML = lon,lat,alt
            lat = float(parts[1])
            coords.append((lat, lon))
    return coords


def generar_shapes(shape_id, coords_kml_ida, coords_kml_regreso, archivo_salida="shapes_codigo.txt"):
    """
    Genera shapes.txt para GTFS con un único shape_id (sin _ida ni _regreso)
    concatenando los puntos de ida y regreso en secuencia continua.
    """

    coords_ida = kml_to_latlon(coords_kml_ida)
    coords_regreso = kml_to_latlon(coords_kml_regreso)

    with open(archivo_salida, mode='w', newline='', encoding='utf-8') as file:
        writer = csv.writer(file)
        writer.writerow(["shape_id","shape_pt_lat","shape_pt_lon","shape_pt_sequence"])

        seq = 1

        # Puntos de ida
        for lat, lon in coords_ida:
            writer.writerow([shape_id, lat, lon, seq])
            seq += 1
        
        # Puntos de regreso (continúa secuencia)
        for lat, lon in coords_regreso:
            writer.writerow([shape_id, lat, lon, seq])
            seq += 1

    print(f"✅ shapes.txt generado exitosamente con shape_id: {shape_id}")
    print(f"➡️ Total de puntos: {seq-1}")


# ==============================
# EJEMPLO DE USO
# ==============================

shape_id = "BinniBusRC06"

coords_kml_ida = """
-96.769135,17.108597,0
            -96.769396,17.10932,0
            -96.76936,17.10941,0
            -96.769118,17.10974,0
            -96.768746,17.110236,0
            -96.768642,17.110062,0
            -96.767352,17.110524,0
            -96.766065,17.111006,0
            -96.766014,17.110974,0
            -96.765487,17.110544,0
            -96.765197,17.110313,0
            -96.764829,17.110066,0
            -96.764652,17.109946,0
            -96.764532,17.109849,0
            -96.764386,17.109708,0
            -96.764221,17.109525,0
            -96.764141,17.109433,0
            -96.764106,17.109362,0
            -96.76396,17.109075,0
            -96.763777,17.108643,0
            -96.763477,17.107906,0
            -96.763424,17.107762,0
            -96.763348,17.107544,0
            -96.763265,17.107304,0
            -96.763105,17.106889,0
            -96.762884,17.106323,0
            -96.762605,17.105609,0
            -96.762213,17.104593,0
            -96.762008,17.10406,0
            -96.761841,17.103662,0
            -96.7616,17.103075,0
            -96.761322,17.102378,0
            -96.761193,17.102064,0
            -96.761175,17.101977,0
            -96.761206,17.101786,0
            -96.761241,17.101624,0
            -96.761221,17.10157,0
            -96.76103,17.101415,0
            -96.760883,17.101241,0
            -96.760756,17.100981,0
            -96.760715,17.100977,0
            -96.760068,17.101153,0
            -96.759562,17.101313,0
            -96.759093,17.101455,0
            -96.758384,17.101642,0
            -96.757733,17.101846,0
            -96.756854,17.102095,0
            -96.755879,17.102363,0
            -96.754706,17.102745,0
            -96.754198,17.102924,0
            -96.753185,17.103269,0
            -96.752696,17.103435,0
            -96.752375,17.10267,0
            -96.751958,17.10177,0
            -96.751536,17.100805,0
            -96.751132,17.099812,0
            -96.750608,17.09854,0
            -96.750259,17.097693,0
            -96.750109,17.097312,0
            -96.749989,17.09719,0
            -96.749874,17.096994,0
            -96.749653,17.096428,0
            -96.74932,17.095618,0
            -96.748967,17.094773,0
            -96.748703,17.09412,0
            -96.748435,17.093563,0
            -96.748281,17.093303,0
            -96.74814,17.092976,0
            -96.74805,17.092772,0
            -96.748007,17.092524,0
            -96.747884,17.09226,0
            -96.747782,17.092052,0
            -96.747703,17.09182,0
            -96.747554,17.091455,0
            -96.74737,17.091066,0
            -96.747265,17.090827,0
            -96.746885,17.089961,0
            -96.746702,17.089502,0
            -96.746415,17.088902,0
            -96.746262,17.088533,0
            -96.746045,17.088071,0
            -96.745849,17.087617,0
            -96.745554,17.086984,0
            -96.745152,17.086033,0
            -96.745004,17.085682,0
            -96.744725,17.085087,0
            -96.744347,17.08411,0
            -96.744165,17.083654,0
            -96.743945,17.083185,0
            -96.743757,17.082708,0
            -96.743612,17.082464,0
            -96.743596,17.082146,0
            -96.743561,17.080744,0
            -96.743465,17.080121,0
            -96.743395,17.079964,0
            -96.742899,17.079052,0
            -96.742893,17.078916,0
            -96.74258,17.078411,0
            -96.741995,17.077403,0
            -96.741759,17.07699,0
            -96.741323,17.076194,0
            -96.741252,17.076072,0
            -96.741234,17.075913,0
            -96.741172,17.075784,0
            -96.74108,17.075671,0
            -96.74087,17.075524,0
            -96.74076,17.075371,0
            -96.740604,17.075152,0
            -96.740321,17.074722,0
            -96.740167,17.07453,0
            -96.73999,17.074253,0
            -96.739714,17.073921,0
            -96.7394,17.073495,0
            -96.739176,17.073217,0
            -96.738823,17.072758,0
            -96.738617,17.072448,0
            -96.73843,17.072189,0
            -96.738208,17.071754,0
            -96.73786,17.071029,0
            -96.737757,17.070774,0
            -96.737458,17.069956,0
            -96.73732,17.069635,0
            -96.737166,17.069275,0
            -96.736899,17.068848,0
            -96.73647,17.068132,0
            -96.736181,17.067665,0
            -96.735806,17.067048,0
            -96.735904,17.06686,0
            -96.735948,17.066701,0
            -96.735976,17.066455,0
            -96.736082,17.066247,0
            -96.736232,17.065967,0
            -96.736317,17.065684,0
            -96.736348,17.065499,0
            -96.736346,17.065335,0
            -96.736294,17.065025,0
            -96.736207,17.064752,0
            -96.736058,17.064443,0
            -96.735814,17.063933,0
            -96.7355,17.063378,0
            -96.73525,17.063006,0
            -96.735065,17.062726,0
            -96.734888,17.062514,0
            -96.734596,17.062116,0
            -96.73443,17.061898,0
            -96.734191,17.061539,0
            -96.733992,17.061242,0
            -96.733891,17.061137,0
            -96.733711,17.061147,0
            -96.733145,17.061208,0
            -96.732142,17.061224,0
            -96.730734,17.061193,0
            -96.730484,17.061144,0
            -96.729492,17.060985,0
            -96.728816,17.060839,0
            -96.728151,17.060698,0
            -96.726992,17.060467,0
            -96.726882,17.060444,0
            -96.726657,17.061519,0
            -96.726485,17.062314,0
            -96.726305,17.063185,0
            -96.726287,17.063393,0
            -96.726187,17.063878,0
            -96.725973,17.064847,0
            -96.725753,17.066096,0
            -96.72556,17.067047,0
            -96.725434,17.067585,0
            -96.725297,17.068137,0
            -96.725085,17.069324,0
            -96.72498,17.069883,0
            -96.724817,17.070752,0
            -96.724583,17.071698,0
            -96.724422,17.072475,0
            -96.723561,17.072347,0
            -96.722304,17.072134,0
            -96.721748,17.072026,0
            -96.720791,17.071801,0
            -96.720472,17.071752,0
            -96.72023,17.071757,0
            -96.71968,17.071642,0
            -96.719136,17.071536,0
            -96.71864,17.071421,0
            -96.71805,17.071298,0
            -96.717677,17.071111,0
            -96.716907,17.070906,0
            -96.71636,17.070785,0
            -96.715976,17.070675,0
            -96.715657,17.070585,0
            -96.714906,17.070462,0
            -96.713755,17.07036,0
            -96.713594,17.070372,0
            -96.713334,17.070396,0
            -96.712704,17.070326,0
            -96.712484,17.070311,0
            -96.712221,17.070244,0
            -96.711619,17.07017,0
            -96.711313,17.070151,0
            -96.710346,17.070057,0
            -96.709839,17.070002,0
            -96.709059,17.069934,0
            -96.708216,17.069867,0
            -96.70696,17.069787,0
            -96.705825,17.069694,0
            -96.704102,17.069511,0
            -96.702998,17.069417,0
            -96.70217,17.069351,0
            -96.700689,17.069211,0
            -96.698951,17.069083,0
            -96.69743,17.068966,0
            -96.696692,17.068862,0
            -96.694692,17.068714,0
            -96.694155,17.068647,0
            -96.693568,17.068639,0
            -96.692347,17.068552,0
            -96.691765,17.068488,0
            -96.691213,17.068424,0
            -96.690743,17.068372,0
            -96.690094,17.068329,0
            -96.68937,17.068216,0
            -96.688737,17.068026,0
            -96.687989,17.067821,0
            -96.686473,17.067357,0
            -96.685403,17.067039,0
            -96.684649,17.066793,0
            -96.683421,17.066414,0
            -96.68204,17.066016,0
            -96.681533,17.065862,0
            -96.681157,17.065806,0
            -96.679851,17.065411,0
            -96.679604,17.065352,0
            -96.679349,17.065383,0
            -96.679261,17.065632,0
            -96.678239,17.066483,0
            -96.677136,17.067393,0
            -96.67586,17.068439,0
            -96.674017,17.069965,0
            -96.672161,17.071483,0
            -96.670479,17.072854,0
            -96.669455,17.073706,0
            -96.668197,17.074713,0
            -96.667384,17.075385,0
            -96.666295,17.076282,0
            -96.665294,17.077103,0
            -96.664527,17.077754,0
            -96.663814,17.078321,0
            -96.663063,17.078921,0
            -96.662164,17.07967,0
            -96.660928,17.080705,0
            -96.659541,17.081854,0
            -96.658632,17.082618,0
            -96.657948,17.083149,0
            -96.657811,17.083233,0
            -96.65783,17.083444,0
            -96.657792,17.083536,0
            -96.657304,17.083969,0
            -96.657186,17.084072,0
            -96.657184,17.084151,0
            -96.65724,17.084182,0
            -96.657892,17.084238,0
"""

coords_kml_regreso = """
-96.657894,17.084227,0
            -96.657567,17.084193,0
            -96.657258,17.084174,0
            -96.657205,17.084156,0
            -96.657194,17.0841,0
            -96.65721,17.084056,0
            -96.657591,17.083736,0
            -96.657778,17.08356,0
            -96.657832,17.083484,0
            -96.657846,17.08337,0
            -96.657988,17.083238,0
            -96.658324,17.082971,0
            -96.658805,17.082579,0
            -96.659099,17.082321,0
            -96.659414,17.082074,0
            -96.659713,17.081821,0
            -96.66013,17.081479,0
            -96.660725,17.080974,0
            -96.661496,17.080323,0
            -96.661827,17.080063,0
            -96.662895,17.079181,0
            -96.663713,17.078532,0
            -96.664684,17.077725,0
            -96.66569,17.076902,0
            -96.667032,17.075792,0
            -96.668552,17.074533,0
            -96.669859,17.073471,0
            -96.671306,17.072298,0
            -96.67254,17.071261,0
            -96.673885,17.070188,0
            -96.675553,17.068817,0
            -96.676681,17.067865,0
            -96.677506,17.067193,0
            -96.678433,17.066456,0
            -96.679288,17.065724,0
            -96.679508,17.065578,0
            -96.679789,17.065546,0
            -96.68076,17.065832,0
            -96.681103,17.065937,0
            -96.681957,17.066188,0
            -96.682246,17.066272,0
            -96.684057,17.066819,0
            -96.684944,17.06708,0
            -96.68601,17.067379,0
            -96.68731,17.067761,0
            -96.688078,17.067964,0
            -96.688774,17.068198,0
            -96.6893,17.068339,0
            -96.690373,17.068493,0
            -96.691354,17.068588,0
            -96.69369,17.068762,0
            -96.69501,17.06887,0
            -96.695445,17.068883,0
            -96.696303,17.06896,0
            -96.696971,17.069011,0
            -96.697386,17.069096,0
            -96.698476,17.069198,0
            -96.701783,17.069503,0
            -96.703336,17.069631,0
            -96.705004,17.06976,0
            -96.706876,17.069919,0
            -96.708781,17.070078,0
            -96.709899,17.070172,0
            -96.711921,17.070336,0
            -96.713204,17.07047,0
            -96.713614,17.070431,0
            -96.714429,17.070503,0
            -96.715298,17.070657,0
            -96.715709,17.070711,0
            -96.716736,17.070972,0
            -96.717616,17.071165,0
            -96.718015,17.071203,0
            -96.719268,17.07147,0
            -96.719681,17.071531,0
            -96.720236,17.071667,0
            -96.720523,17.071829,0
            -96.721736,17.07216,0
            -96.724415,17.072567,0
            -96.725332,17.072767,0
            -96.725577,17.072883,0
            -96.725662,17.072726,0
            -96.72581,17.072016,0
            -96.726057,17.070752,0
            -96.726301,17.069526,0
            -96.726384,17.06906,0
            -96.726411,17.068698,0
            -96.726505,17.067408,0
            -96.726534,17.067178,0
            -96.726553,17.067026,0
            -96.726708,17.066244,0
            -96.727009,17.064793,0
            -96.727202,17.06386,0
            -96.727293,17.063421,0
            -96.727478,17.062606,0
            -96.727502,17.062442,0
            -96.727653,17.061621,0
            -96.727677,17.061521,0
            -96.72787,17.060649,0
            -96.728047,17.059729,0
            -96.729066,17.059921,0
            -96.730785,17.060267,0
            -96.731574,17.060449,0
            -96.732143,17.060549,0
            -96.732215,17.060044,0
            -96.733036,17.060131,0
            -96.733532,17.060793,0
            -96.73406,17.061593,0
            -96.734347,17.061911,0
            -96.734911,17.062739,0
            -96.735112,17.063052,0
            -96.735495,17.063593,0
            -96.735721,17.064019,0
            -96.736077,17.064788,0
            -96.736155,17.064983,0
            -96.736185,17.065132,0
            -96.736281,17.065421,0
            -96.736276,17.065539,0
            -96.736238,17.065693,0
            -96.736158,17.065875,0
            -96.735876,17.066119,0
            -96.735713,17.06609,0
            -96.73553,17.066137,0
            -96.735359,17.066332,0
            -96.735257,17.066488,0
            -96.734412,17.066757,0
            -96.734656,17.067019,0
            -96.73509,17.067526,0
            -96.735587,17.068254,0
            -96.735989,17.069014,0
            -96.736179,17.069506,0
            -96.736327,17.069916,0
            -96.736437,17.070152,0
            -96.736657,17.070965,0
            -96.736917,17.071439,0
            -96.737418,17.07239,0
            -96.73788,17.073152,0
            -96.738545,17.074331,0
            -96.738937,17.07489,0
            -96.739283,17.075308,0
            -96.739578,17.075667,0
            -96.739744,17.075959,0
            -96.739948,17.076406,0
            -96.740476,17.077577,0
            -96.740712,17.078113,0
            -96.741238,17.079157,0
            -96.741624,17.080069,0
            -96.74168,17.080246,0
            -96.742316,17.080628,0
            -96.742504,17.080762,0
            -96.742705,17.080962,0
            -96.742898,17.081177,0
            -96.743014,17.081346,0
            -96.743349,17.082085,0
            -96.743529,17.082554,0
            -96.743684,17.082895,0
            -96.743883,17.083272,0
            -96.744119,17.083905,0
            -96.744451,17.0847,0
            -96.744682,17.08523,0
            -96.74495,17.085892,0
            -96.745063,17.086156,0
            -96.74554,17.08723,0
            -96.745835,17.087894,0
            -96.746337,17.089017,0
            -96.746686,17.089907,0
            -96.747152,17.090932,0
            -96.747662,17.092076,0
            -96.747866,17.092578,0
            -96.748013,17.092968,0
            -96.748204,17.093365,0
            -96.748515,17.094091,0
            -96.748705,17.09457,0
            -96.749177,17.09557,0
            -96.749569,17.096473,0
            -96.749789,17.097101,0
            -96.749918,17.097442,0
            -96.750162,17.097842,0
            -96.750441,17.098554,0
            -96.751031,17.099903,0
            -96.75139,17.100736,0
            -96.751637,17.101292,0
            -96.752155,17.102561,0
            -96.752428,17.103084,0
            -96.752586,17.103487,0
            -96.7543,17.102915,0
            -96.757347,17.101972,0
            -96.759673,17.101302,0
            -96.760724,17.100995,0
            -96.760845,17.10122,0
            -96.761218,17.101597,0
            -96.761228,17.101672,0
            -96.76118,17.102018,0
            -96.761499,17.102869,0
            -96.761859,17.103746,0
            -96.762304,17.104853,0
            -96.762765,17.10606,0
            -96.763267,17.107353,0
            -96.763422,17.107796,0
            -96.763777,17.108643,0
            -96.764031,17.109242,0
            -96.764179,17.109496,0
            -96.764412,17.109755,0
            -96.764697,17.109988,0
            -96.766065,17.111006,0
            -96.768661,17.110064,0
            -96.768733,17.110255,0
            -96.769217,17.109604,0
            -96.769367,17.109398,0
            -96.769376,17.109248,0
            -96.769135,17.108597,0            
 """

generar_shapes(shape_id, coords_kml_ida, coords_kml_regreso)
